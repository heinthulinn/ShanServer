//====== roundReset.js ======

function resetPlayersForNextRound(table) {
  table.players.forEach(p => {
    // ğŸ”¥ If they were waiting (spectating), they are now IN
    if (p.waiting) {
        console.log(`âœ¨ Promoted ${p.username} to Active Player`);
        p.waiting = false;
    }
    
    p.ready = true; 
    delete p.currentBet;
    delete p.cards;
    delete p.hand;
    p.hasDrawn = false;
    p.drawAction = null;
  });
}

function resetTableState(table) {
  table.gameInProgress = false;
  table.isProcessingResult = null; // ğŸ”¥ CLEAR THE LOCK HERE
  // ğŸ”´ CLEAR TIMERS
  if (table.countdownInterval) {
    clearInterval(table.countdownInterval);
    table.countdownInterval = null;
  }

  if (table.betInterval) {
    clearInterval(table.betInterval);
    table.betInterval = null;
  }

  // ğŸ” reset values (NOT null)
  table.countdown = 0;
  table.betTime = 5;

  // ğŸ”¥ round authority cleanup
  table.dealAckReceived = false;
  table.watchTimerStarted = false;

  if (table.watchTimer) {
    clearInterval(table.watchTimer);
    table.watchTimer = null;
  }

  table.currentWinners = [];

  table.roundState.inProgress = false;
  table.roundState.startedAt = 0;
}

module.exports = {
  resetPlayersForNextRound,
  resetTableState
};
