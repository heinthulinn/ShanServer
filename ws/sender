const WebSocket = require("ws");

let wssRef = null;

// we inject wss later (IMPORTANT)
function initSender(wss) {
  wssRef = wss;
}

function wsSend(ws, payload) {
  ws.send(JSON.stringify(payload));
}

function broadcastToTable(tableId, payload) {
  if (!wssRef) return;

  wssRef.clients.forEach(client => {
    if (
      client.tableId === tableId &&
      client.readyState === WebSocket.OPEN
    ) {
      client.send(JSON.stringify(payload));
    }
  });
}

module.exports = {
  initSender,
  wsSend,
  broadcastToTable
};
